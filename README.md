# BusSchedule Backend

Данный проект представляет собой бэкенд-часть веб-приложения, предназначенного для работы с расписанием рейсовых автобусов.

## Возможности

Система позволяет:
- Искать автобусы между двумя остановками
- Управлять маршрутами автобусов и их направлениями
- Управлять остановками
- Управлять расписаниями прибытия автобусов

## Архитектура проекта

Проект построен с использованием современных подходов:
- **DTO (Data Transfer Objects)** для передачи данных между слоями
- **PHP 8 Enum** для типизации
- **Сервисный слой** для логики
- **Laravel Resources** для форматирования API-ответов
- **Form Requests** для валидации данных

## Требования

Для работы с проектом необходимы:
- **PHP 8.1+**
- **Composer 2.0+**
- **PostgreSQL 13+**
- **Docker и Docker Compose** (для разработки)

## Установка и настройка

### Установка с Docker

1. Клонируйте репозиторий:

   ```bash
   git clone https://github.com/OlegYap/BusSchedule
   ```

2. Скопируйте файл окружения:

   ```bash
   cp .env.example .env
   ```

3. Настройте переменные окружения в файле `.env`:

   ```env
   DB_CONNECTION=pgsql
   DB_HOST=db
   DB_PORT=5432
   DB_DATABASE=postgres
   DB_USERNAME=dbuser
   DB_PASSWORD=dbpwd
   ```

4. Запустите контейнеры Docker:

   ```bash
   docker compose up -d
   ```

5. Установите зависимости и выполните миграции:

   ```bash
   docker compose exec php-fpm bash
   composer install
   php artisan key:generate
   php artisan migrate --seed
   ```

# API Эндпоинты

## Поиск автобусов

### Найти автобусы между остановками
**GET** `/api/find-bus?from={stop_name}&to={stop_name}`

**Параметры запроса:**
- `from` — название начальной остановки
- `to` — название конечной остановки

**Пример ответа:**
```json
{
  "from": "ост. Центральная площадь",
  "to": "ост. Университет",
  "buses": [
    {
      "route": "Автобус №42 в сторону ост. Университет",
      "next_arrivals": ["08:15", "08:40", "09:15"]
    },
    {
      "route": "Автобус №21 в сторону ост. Парк",
      "next_arrivals": ["08:30", "09:04", "09:30"]
    }
  ]
}
```
## Управление маршрутами


**Получить все маршруты**

**GET** `/api/routes`

**Получить маршрут по ID**

**GET** `/api/routes/{id}`

**Создать маршрут**
**POST** `/api/routes`

**Тело запроса**
```json
{
  "name": "42",
  "directions": [
    {
      "direction": "ПРЯМОЕ",
      "stops": [1, 2, 3, 4, 5]
    },
    {
      "direction": "ОБРАТНОЕ",
      "stops": [5, 4, 3, 2, 1]
    }
  ]
}
```
**Обновить маршрут**
**PUT** `/api/routes/{id}`

**Удалить маршрут**
**DELETE** `/api/routes/{id}`


## Управление направлениями маршрутов

**Получить все направления**
**GET**  `/api/route-directions`

**Получить направление по ID**
**GET** `/api/route-directions/{id}`

**Создать направление**
**POST** `/api/route-directions`

**Тело запроса:**

```json
{
"route_id": 1,
"direction": "ПРЯМОЕ",
"name": "ост. Конечная",
"stops": [1, 3, 5, 7, 9]
}
```

**Обновить направление**
**PUT** `/api/route-directions/{id}`

**Удалить направление**
**DELETE** `/api/route-directions/{id}`
 
## Управление остановками
**Получить все остановки**
**GET** `/api/stops`

**Получить остановку по ID**
**GET** `/api/stops/{id}`

**Создать остановку**
**POST** `/api/stops`

**Тело запроса:**

```json

{
"name": "ост. Центральная площадь",
"address": "ул. Ленина, 1"
}
```
**Обновить остановку**
**PUT** `/api/stops/{id}`

**Удалить остановку**
**DELETE** `/api/stops/{id}`

